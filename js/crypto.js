// based on: https://blog.elantha.com/encrypt-in-the-browser/

async function encrypt(content, password) {
  const salt = crypto.getRandomValues(new Uint8Array(16));

  const key = await getKey(password, salt);

  const iv = crypto.getRandomValues(new Uint8Array(12));

  const contentBytes = stringToBytes(content);

  const cipher = new Uint8Array(
    await crypto.subtle.encrypt({ name: "AES-GCM", iv }, key, contentBytes)
  );

  return {
    salt: bytesToBase64(salt),
    iv: bytesToBase64(iv),
    cipher: bytesToBase64(cipher),
  };
}

let decrypt = async function (encryptedData, password) {
  const salt = base64ToBytes(encryptedData.salt);

  const key = await getKey(password, salt);

  const iv = base64ToBytes(encryptedData.iv);

  const cipher = base64ToBytes(encryptedData.cipher);

  const contentBytes = new Uint8Array(
    await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, cipher)
  );

  return bytesToString(contentBytes);
};

async function getKey(password, salt) {
  const passwordBytes = stringToBytes(password);

  const initialKey = await crypto.subtle.importKey(
    "raw",
    passwordBytes,
    { name: "PBKDF2" },
    false,
    ["deriveKey"]
  );

  return crypto.subtle.deriveKey(
    { name: "PBKDF2", salt, iterations: 100000, hash: "SHA-256" },
    initialKey,
    { name: "AES-GCM", length: 256 },
    false,
    ["encrypt", "decrypt"]
  );
}

// conversion helpers

function bytesToString(bytes) {
  return new TextDecoder().decode(bytes);
}

function stringToBytes(str) {
  return new TextEncoder().encode(str);
}

function bytesToBase64(arr) {
  return btoa(Array.from(arr, (b) => String.fromCharCode(b)).join(""));
}

function base64ToBytes(base64) {
  return Uint8Array.from(atob(base64), (c) => c.charCodeAt(0));
}

// other helpers
async function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

// Encrypted Content
const ct_serial = "eyJzYWx0IjoiUzJtM2hkNTY4R1ZLTUhYYVVGV1ZZQT09IiwiaXYiOiJXTEorbC9sdmVVQVJQT1BNIiwiY2lwaGVyIjoieFc3VUd3S3hSbDgwclBVcVpFYnYvL2FienpUZ2ZTRWdlaFhUTFA2ZHF3dFNBSUdZTFE3TlRtOFhzbmhDUEhXaHlRWkVqMjMrQlZsNWJibUtKR0N0c0FWUzhTUGdYZ2t4SVNSdTBLa045ZDJyTG9YMDBQdkpyNmpQSlB3aWk2QlBmbUJkQnlKVjFXNFZTWUc2Q2RCTjlhS0lKd2pvVnh1Ty9scGlHd0ZtZVZnKzBaZ2xtRlFNVERBRGtxZ3gwaGFEcGVmK0VnQWY3eXpFL01KQ0ZTWlJ0MXlmNmJjZGZ1T1VGTjhZWkJXQktuZDRxQlF1MVhrd0pmZWdEOUloeGZrMmpGTGYxMEYySDZDYkFPNWRuVGI2SzJmY0lCK1ZYSU1ndlRtS0dORGNvcUNTQ2lTbzhub0diWm45VUZCUGJ6WGZkRklscXFWMStFdkhoa2VsT05GL3Q4dm82djluWlZpNXVtWEgzNHlEWm5JN1ZzNXo5b1hDQjNtbVJlZGhKQkwzN0FUSVphM1dqcVBEdTh6c24rSkZvaEc4eituMjVmTDlXdHEzSmdoWFVqZ2JCSzJOMG90emg3UHdWMlR3MUM4OUhJWTJYemtHRFM2bk5WWmJlMko5VThCU3JjMndZSmt2NzQzQy9HOVJVMUVObnQ3N3FYZmE3dXVISDRUNlYrMjdnV1N5Q3BxR2xDclVia2lkenJDUUwrSCtKelQrZjFnZEoyRm9RUENpYTl6Y1JBcEphN0RjZm1VYjg4SHIxQXlLTFgvL2VraE1zTHpmOWxlaXlHcUQvaGREZS92NFovSlNubGhhY1hUVlBOTEZtMFlhQ0RkSXFFVk5DNHdFRWNhaTBsQVhZQ28vbitrMjB4eXZsS2FnRmhjZFRCU0JkWjZzdkRhTkFhTUpJbWRIY0hYc2pKak5ibzlMQnp3UDh4V3pLVlN1OFlPNFRRY3VhNURlcjVwdGtnS2FhbG5lRzNOaTNOWlhoT2dBWUNNNVY4SVZ3VllaQnZaUGxCUFZlbitvYm01ckZyczdLVGR5TExQckpuYitTNjBzc0V3UUFJVkl2OUROemdMSlFZTkFIQXdsclJ0dktBWWJJRXdUVmp3WTVXU0RXOHhvd24xaWlFZkJHY0RCWVZYblRoaHpGUWhvOEJ2RzZjdS81U1hZSEE1K2lTRWlNOHlaTStreDNnYm5mRXYzdFJmanZUcEJjN2kxWU5uV2tyYldiU2dBbm1qYnVvY05RSXRaQmRURHJscnU2VEM1TGpKM09zS0ExU1ZSajhoK2MxbjRpeXRQYTMrTTAxTFFNb2dFRmhjWVh5aWxYd05PNEZyWjAxMGRhWjZCUm12Qk54MzUxTE0rbkhYcTZPeThLZkQ5c3FWcEZSMHFSWG9PUjVqZDVXS0p3b3ZTM0VOQys5UjhTV3F2cVphUElEbTEwQnZlZHYxVm5MT2FSWVlDV1JOeVdEaXZRRWFicHR2Nm9PWnUwbk1abDhxZHpYMWxRNU1yWFlMME9DclhWRHV1VTZ3UXpUcm55Ni9lSWlFWFUwdjYvN1ZrQlhBUy9VTDd2R3FyUlczL3JTcnNoNjZBOVhQMEhHK0FLUlJFelU5OHVrcE1MdTZLUzJNdU9pUUNQZ1RSYlhzTEhvVTFuOFo0MDdHQVY5T2dibHBFbFI0bFdiWFdKK3FQSE9TVldLUUZYSlBzOWpTbklVTWF2dE12V3FjUGhqK3ZJN2ZhVUV4V1pmOGRaL0N2Z000T1BFb3dtQnB2SjNLRkR5dURpQzZZSTZ6dlY2UVdmaUEyU2E2RGdvNmJBckVwSUNWYTdRbjlUM2FKSGsyemk4S0QzbVBMSjNvNmR3R01rMmZDaEdpNS9CK2h0cEtVa3BUbFBiaDlNVDBrTnhRK0h6TXVUdkZRWm9palRrZUZMRGNxcGc3Y1pzamdrY0RRblljdDh6NDBoSFNvbjFueWtwdGlXSEYwL0N3SFpqYm5TeXJSOG5oSDJJUWFJeS8xRVBSeGdnazZCdEFnak9JN2hhVjlHdE5MbkZzWVZQamg5UE01Q0tNQnBJaVBHYzZXdFJRTmlMVnVJcS9lWng1ZXh2QVlnQ2lSOE1qZ3FHZnlPU0hlSG1ER2pmdEF2aTBEaWxyZzNXZVJyOG4vUW52L09jWHRSZzdla1NUNWlka1FNQVViUHVuUXY3Ky9Qb3JHVVZFQ3RuTVl6R01MWndoc3QzNFhqZjFYTktEU3Z5TmRRUy9ZdElLNm1pMW4xa0hMd1psK0xkSHhzNlFZOW1PT2VjbnMyMDFtVWg2M3BmcUVkc1oySit6cXdNNnBzNHhYUURQR3krZk5aOHprYlZTYmljay9kUUNKMzJac3E4R2hqMHBmbFg2amdTU21LaXRsYmsvd0dHYUpLMFdVa00vbi9peUthTzZPQkJ5MU4vcGZnVDdPcktBN3BDMDFTUFBGYUxMTWh0VHRtVWl0eFFaUXhaVjNkNDh3S3c3Q3loYmlXSG1kOW44VTgyWkJaNEs2RzlrRWhLUDduOGI2ZFVXU3FHWmNXZ0pQcUswOUZBeTlmT2MrRk1IODNVRkZKazB2UXEySWp5dno2d2MxRUVwU21OTG1xeGZSQ2ZTczJ3Y1lvbEFiZXZnT3h5clI2aitqdjJ4eWlhQ1pPSnhSbDZMWjRLREZTaWtHeTJTM2djMndrUS9ieG1XRG01Sis2YlJDeU9peENSWFZTZXV5aHMxTFNmdVhqNHJlclR1R3BLVzVEc2d6bW9zdkpWM3ExeXMrUzdtZkxKeEpjWDVEdUZTdmhOQVRpZWVPWXRWMDdhckFGK2d3emN1MHJPenZ6SmFlbVR4NHhoWS8yMkN5M280RDRRWGlqNDN5YkFlelNBVDZBNjRZaXhSRnliZ3NqNEEwRmV3OXdwZkJhbmhNRDl3dkZPeFpoY3JqZjRmdG9yMno4eVpmQTdxZmVic0wrQWlkN1pPdHFyemdkWjdzbk9NMVhEN0ZLOG9GYnFGTTdMQmM2b0Q4NTEvTVl6WGp5SGwwLzRpOTdVSGRXWlFPaGgveFFBMDVheFdHUS91QVBhK3VwWWpVd0ZVOWVpV1N4eEJrYlNJNEVhVTZ6eTNmOWswMG1hdlltTERDRUhhczcvaEtaZm51a21YVDVJVWJzVmVxY2xoSzBPSWF3VUhoQjkyNWFZVTVUd0k1bEg0bWVtaVZyemZxQ3E3UnRISjB0OGYyR0pwTjBMM3BWenR1cDhjWlJ6UXNaQUV1eGEvVXlIYUlmQ244Nnpqek1McFQ1MkxLYmZQK0xEZVdmVTVJWER0Y0tFNFgrZnFpV3hmSTVoa2pCTnVseks2SHYvNmM1WTVPNGQzQlF4Ni96bHRBV2ZlKzVRd1RKZjdDZ2tYNlY0cXd2UThnSUNTQ1JjTG03RWg1eGpHcGQzbzFoUXhZZUhZK3d2L0Q1QXpKWGpiaFR3a21GaDJRekNwYkJHdDVnV1VDNXVLYnpyME95ZDg1OFJDV3Bmell1Zyt3bEpnWC9VZXRVUEVDbXc0cHRJTkR5MmRsYW1iZmlsTlVKbWtGTHVsbTRCb3IrNGlTdkc4ZzNmOUhhMTYzbXBhLzlNLzNuVnpPS2xoK3RMejlSZGN3VnYrdUsvSVNGTzUyQWFXR1ZFRDF4WUJjVWErb202ajY2MDhkVXZuZGt2RWxGTlZkTXIrUzE4cmo5MGsxSEdmK0lCdlpVQklDcTI0ZnBJSzZ2T0YvVVlIclZOUVh3NVo4Sk1SWkpBQlY3OUZSV0Q4dHBQcFM1RTdhSlp5VHpPelUwODJic25nVmJIOU1Ea0V5QXd2cFdPR0V4TUNTVVdKdGFnRCs4VkIycGg5TFlsNitYSVdzMjlzQXRBcnZFbEdGWnNrVnc0VEhVMVQzc0tHWEtUdENFM3hzL08vUmJPVU9mNDd6WkVjM29kTWZnZVhQai9DeVdHSzBpL1kzc0QzM1F2NTNndUNpL0MyYkU3WE1QWlpkdTZlazlSc1dVb0Y1UDBzaUZXelZmTlh6eWVkaVRENVIwdkczUlZXeFVVcUhBSEdkeGZsRXVQOW9FcVZxTVFqWExXRkdqM3ZRb3VEVEh4dFBBVVlZaDkzYmVhU0RYb3JIZ0lUUzk2VTJFYXdzNzZiaEtFRi8wbGRNUGgzV2NjZG1OR1VhS1lTeUNpZDRid1N2TGx1R3dLUDczUExaVUFzajQ3K1cvdWQ2V08wc0p1WXQ2dzZLRTZ2MmNrSGxOU21iN2FRZ1N0NVRVSzhhWFdkK0tWdEJkaGdFdnMwbXhRSUR6Y1FiYVhMblNXZkMyODV4Y1NrMmZBZ3JCbG54UHdKWUJGMlpxNlFFRmNsSjNlUFQvQjNyR1FvbEdTb21FOXNvRnJGZFFNZGFibVg1Yk83NVVkbVpDNUNXdzNXNThpMHlFNUJFOWE4V2VkTVZsaDZLQ1J4dXZwYmhwbTVxSGpEOFFSU21KYzNPbGQ0enNyczNaKzB3aXVYSXpaTnozajZvN2ZhL2I1ZU5IcGZ2ZEg0T3haRytxbEhDVFFwZllQTkN4cllRSTI2c20rNTdEbXVKbkxLcGJPeGlyNjNxMjRlY3ZoNndvNTE5UVZQOWtrVHloTlNteEJMOG51NDA5QmlHRFhjclM5VTQrcFZOVEVvOXZqRG5qZTVCdExkZEhGT0w4Tk9WK0ZCZ215NTJ1NDlhQUg2aStCNUQrdmhoL1lYbytYVEwzR1ZTT3kwNkQreXMrRlllcXl2RG9mNzVUUjRsZjJqOWJMcWhzM0RoK1BNMHk0S21tdC9DV2ZnV212dGhyeWNodE1MMlhnT0ZQblZYTFo5OGtSemZRNVNoNnErVmoydWZzWXFiZFRnM1VEejFyTENKRmpnclEvWmw4U1Yyc1cwclN3emJDQTZleG1FOFRPM2Mzb0VwMml2VndxZGNwTDUweVc2RjlFYjFkWVFTQ0FUYlRFbnlnV1ZzZTdyQ0U0WDA0Mkt3VThqdTg3b1BjZWUzUGV4b1RuRTMydVZXU3cxMGlxSWRWbWVHS2JndGVtQ2hRcFBKaFh2SWl6d1loSlE3RE84Q1p5bUtxWkRzaVJSdldQenV1VWZzVzI4OXJGb0liMjdpRFd5cUdDZU4wNXpqWHNISFo5a05BVE9HOHU3czA0QXJQMzh2ZjFYcGtzR3g4dmxROW8xTTZxT0Njc1lYYlljbnRCSUxVSURqamVhWDBWUHYyc0xNVG9PQU5XWU1LZU9odmFqOEcxTXFZN0pZeStmWDFQbUZnNitkdkNva2JrNy9OQUhPU3RRY0JGRnUwa3Vwelp4OHNBWjFMOCtZUkdEZDh4ZXNDbDU4SEIveXBpTExIQ2daS2xRcVhLcmVlUk95Qk9WYVlVdUtoNTNJL0FUd3hPTnVDanh6cVUzN2ZrbEhQYmpwOXB6eHF3NkFiQkw1dnVFZ3ZKMEZxbmFFRTArRklzbld6UzJueHllWk5sOUtFYTJTeHdKY1h4YTVPSDd1MjFtM3VKZHpya3E2dW5xSi92SHVJS0VZajlKN3FQblY5VUlUSEFTaURsbWExblJOUHg0aGJIbGVNS204RjBsalBzNW5Na3ZhTDJEVlRVS3lpb2ZWekdzV1NBQ0ZuZURzU0YxZ2ZaWnY3ZldQQjNYOGpHY0Z1dXc2Rjk1blVHb1UreTQ5ZGVqaFNyYmFleStOQWFjMVhIOFZJSkUrSUtKSXhkM3pXcUZkNnFDdmtoZExLVllQZGYra3RRR1BseThlZVppQVlRd1ZRVWh0cit0dE5rK1ZOSDh4clNWYm1aQ2NBeitLbEtNaklyYlV1eWY1KzdIcXpDcktUMVAzMnVDNzh1YTJhTkE0eDFnMXBCWWNONkF1Y2crRjZFNm5pRW9vaDdQSHBnOGJoRnFLNzc0ZE53RldyQkdTeUFBZXpYd2J5UFd6TFYzY21SaFZuaXFSWk5YMklFeVpXRTdCenNZS2dTdGxmUkdHYlBHSkE2N3lDa3QzUDR0WUpVN2EwQ2twK0luZ3dGRCtxUTVRNlN5ejBvNUFYWS9zWS93TndMMWJ3S2JSUDVsUkZnMDd2Wndwbk1EckJ6WFJWTkd2ZG8xTUx6bk1YNFJOQllGSFJJaDNUa2djTmFZNjZzN3QwcjlXRFNOSldmL0hHeVBSMC9EeXJPWWZXTVgzRUVsekx2NE9wbjhKd2ppVndsSjkrc0ZZeXVrQUZhNlQ2RWRrVEhJRmNDMzRrZUxyd0NSeEJRbjg5a1BYamZrMHNBdi9rYzlVVWFvVCtybnpFeW9icm1ZOVh0M2NxZndmTitVcHJaUFljRThBTEJSODlnOGZtOGxSVUlXTzJzbWNiYU9zMW01ejNJZ3U1OUZySjhoL0Rha1pnYnJCbW9MOFhFdElHVURTM2c1YVFuQUJ3cW0xbm1vY041ai9qa1cvOW9rV3ZuQ1o2YUkwN3RkSWE4Sm9DWDVVTVZub0tsamRxZ214K1FCRVR1eC92cHNaelA4TmVuNUI4SXc1bVhuN0N0K242eDhtcUlXZ09ZQVBoYnZhWkZPd2o0UjM5dkthSzNrWkFuQm4rcVg1MlVIdjN1TVJvTURaYzZLSzliWmJ3Rk1ESEI5TnZCMlBubnNiVHlQVFY3aXdzd2c3ei9td29ZUUJSdVM5SlNaSkRLR2s0MW8rWW1FVjhKdlpSSGJDa1Qvd3l6WmVUeWJ1QXU4Szk2M2Nwa1RJWVJCdGt6QTRmUzQrSHE2bnJyejQrNUxGQTh2OUE5MU5VUUVQL2JRdERralFVaGRmVU9oUjVGbDJweFNjQVkwazYyemQyRFVKQjBqREpjdUlDbVhaRVJ3WUV0RUlCRVJnaFdzRis4K215M2krSjRVWUl0MXdSQWFBK2d3KzVjdzB2VmNSSDU5clRWVEJBcWNNZFQ4OVZ6bVM5RVhwMWFoWlBubXpYRVlIUCs2elhqOXBjRkhDQWRaR1BOVDFML29nV0hrNTNBRFdMSXJiMExLQjNCd0NsQjFaUlZ0QzZuQlVIV1BLQzlCbmdaUmlmWnNxTFhjU2hJLzZSeWRjcjRWYkJWd0IrWFZScEtMYW5IS2hYcU1JTUFYd2hTaEs2SittQTVuejFXU2JNUHpPWHVDWHM3cFZvOUFSNUE2TS8wN1o2bU9USG1mYXN2b255TWRxbnVMTjcrSmViRUROc0FMSlBQdlFOM2JudW01dkpRZG0xOXg2SGxSWjhyTlJya1k5M1BoM0xVYzRRNVRoL0tZaEpMby81VVFGYXZhRVNkbytUVDNiejlmaUFxSE53VmVJclhhTFdXYXA5Z0V0TVp2SXlZTEZXN0xmNGIwemlEc3U3SE5YQTk5TTA5dm9ycW1Oc2xJMWFOSUhEd2ptTUxYS3NTZmk0dDB5OHlDT21uYVM5eFhKa1ZSOWV0QndpeC9ESkxNaWRWYlBwUjd3Z1QyRkxTTlZlcEhNaUtBbWdqM2pmcHg4L2llUCtyalBFdnNNdGM2NFU4cUVoSDNodWJSTy9DVTNDRktSdVliMjJEVEZ2L3RvYjBjVHRQdEhtTGZPVTdNQW1PS0Niei9NSldMWUNZNVJ0NjFGOTFYeVZMaUZqSHkrcWhycy9OMnFsUk9Ma2ZQRGJacUw4cENuNTUxbllxbDNzM0JkWkpVK1FYWnE2dSt3QTdZNXRaUGc0S1I0UllWK1o4V0NPUGJpTXFDOGFqbmxES0pFQW9KZ0RvemJ1Ly9ySXBId3pLMEF0OU9aRks2aCtoQ0szMXJpbSsvMHozUkkrQVdyRHV0akdpZ09xYTQ0UDh0RmVEZTVXMG9HSmhibUdzRHdpUUYxdW4wanVyOGdLbkY3TDAzNWluQnhjK3FwQ040WGZEeW9uU2hNVXhIZTNZOVRIUmFySllrMXd6b3hQMkM4RzZ3YnVGMUttUFgvZ1NNeFRNZ0lRaEZEUmY2YWxwdHYwQ3BHL2hhSHBiaHJTNk04aVZnQzliZ1ZaNWpsS00xeHVuSWNIQ3VuM3o1UDllUk9zUVdyMjkxZTFrNGU4T2sxT1FGcHJEMzFoc3lHcjlxU01OaVdQTWRSMy9KQVRsMnhWWWN5NWQyMTB0RFJ1bGpqUlNrc0U5K01GR2I1dFRESkNjL203eldBdDlqVnRyUktzN3NSWUpkRUV3UmhTdFJqOVc4dmpvYkVqTlM0ZUFsMzU2dWJUdis3dzQzTEVDT1NidGw1NnlVL1pla0F6OTNWT3NhMWw1L0R2WElQWXZoMTA5dTlxOEtYZFNzUnlzRWM0eEIzU0p2RlMwdHUvTWp0MkZNeVova3RCS3FxQ3pERlJPSHlqbnNCNHZsSGIwdlhlQWVZektoV0xDaTBSZEFQU0JPam80VE1sOW1iaUNYWDMzOTRpRUNnc1lGd3o0bm03b1BUTjh4YmZuMktScnp2RXlhQUNoWnJ2TndXK21McVp5NVdPSlBlakpOamdTenoweVhSYTZFNWpqWnJ0bXJ6SjhGcU9RVGd4QS8raXFKUFNHblphZDd6Q1JUOTBhYXdKbDhLOHNRVWdMd3VDNFdZYTBYODlJYW9mUks1TkMwOXZVY3hGZXkrYXMrOUlvbDY1VUdnTlZvMVZGOGNaYVY1aXRNRnJNa051WDhqMWU5c0tpRmNOeUdjQXFheldLQ0RCWGZadVRUak0ya1pVMHRNQXVvM0VsMWdDZXlTTE9MWEl3dzBoR3Z1eDlaNUE3MGxYeWEzUFRrY2JLNjdNaE4vVDIxc1JIc1l1QWdJcEFoY01oV3hEa1lON0E1bnBTUHlRS1dHNjd4WVFpT0dTQWNhaEhNY0tXdlBtcU9Fak5Vb01lUXk4UVdxcTF6dmNqWVNpbXJTcnN2c3V6am56RGQyU3lvQlp5K2h6R2YrVWQvd3RlajREbHpWOFRYRFpNQXdLYmI5UVFBVkh2SktzT0VPOUNqR1p2Ym9iaERPQ2dnT0IwNkdSTG9QRWtVWXFqeStEYVFXYlovZ2thNWx1cnRYNC9USkVoNmxkR2hPWEQvRllkWFVJdzB1OUJGZWgwd0ZvajFHd2taY2lwVzdUSWhTRWh0SjNodFBGbWFRVDluRTg3RXh5OEJFU3FnakJ0Q0xkdyt0cjRoMExsMTAxWkFkclg0WFBDZU0vTkNvS3g0aDBad2QrdUE5ckF3RmlHOXg3Zys2bG9NeE16dnRPOVVSWktibHdxMHpyS1RFMUZIdHJZY0dETldxbDUwWU5WR1lOTTBWWnFFSXlDRE1tYTB5aStObC9KcnFlVHZ6WTZTbytYUTJzcERKWUlhWDBIWGdwNGlFaW8wQkdkRU5GOGdpNnFFVG1ZNHJOeHNGY0pkeWhoYmliRHE1NUtTZnkyVlNaczJxdFUvYWlodUVUN0YrRXh2SWc5bWw5eHhWcjB3ejVVR3J1U1dVRWJmSFc2aE9VbjQyNEhXK2ZqcFYraXN3SDN0Slp1dTUrWlFLT0xldnFLZ2R4UmdsNW9iOU1zQkYwSjJDYWdQQnBXNkIxUXorYzN3T09zRmwzVjFlNWZiVkFUYlByUHNjUVJyS2N3bFhsd29wQmlUMTE0bHBHdkJVOHNvZ3A5Sk1wRElsL1VzNTVVNmVibWVBVGlUemN2V2dpUWVJelpGdFlnNEFjQzFHOFF0YUdqRGR1Y0lxaGpOcUxGSnMxVkxpSmNFdWZFVGhWL3hoeVJDcDFud1R6VmE3RFFOeERwQS9BSExNUXhpLzA4MEdGdnMwMndiOXIvQzVWRGxMNFNBZ29tYjNMMnZWWEhpa3ZzV0RkRXhEaFM1QkJablk0NHpKVFRRU3loUnRYb252WWREbFB0UC9DRFQyN2tJeHNMQllJRFRRZUl0Y0FZNkdCa0xpSXFmSzFMQUpBTC9jYXZuMWxvNUtaaUhiejdackhCVld5RjVqOThBZ1BwMzB2T3ovRWdRRkg3NGpUUENTK1ZVejdrZ0xJcVlpNU8xWGUzaXlLYndNNWVXa29lS3ByeHJqUFA3cXVUei94d283dFBaTldBNCt5dFN2cUtub2NBZGd6RFNPa1YzV2lHR01TUndZdUxaeEMreHhTZ0plTUloTXdCc05hSlhicGxzZFNITVlvS0xEU1pUSmgvNmRHVGl2dFlEOHRLR0FmWGRiMWptNHFJSjFDUE80b2NzZTdBRFNTRjZjUkRDTDBSN2ZreDBMNitkRmdoN3RKMEMrQWFkL0hWL1lVZW5TeHNsTEl4RC84RlZpWllHVXRsZXg0VmJndENSSDBhQnluN3ZPQ3g5N1ltVlRnVUVnQWZqdGtSallvK0ZNSFlyeU1wTUpxWisrNlFPMnc2TENYS3JxOXpZMmt4WHhYNlRKQkZxK1drSXBDaDh2RUhwckdWUjdFVzZEV3JHMTdMb291RGhKTzNQdmtqN1dKQ1N6aTMwZjZzQURXYXNrd1NzVzlSK0tYaFJDbUhlMTc5d0xuMjFoUmI4WjlEZTFhV0FMTU1OR1lFMFlmKysyK1prZ24wc2g3anZTUDRSWHlTQ0NCcU1KVXIyU1VpM2UzOUdjNU5RS2V4ZHRDbmQ2NTF0MDRlWW54T3BJYXp6ZFQ4RUZvMld1YTVLWUkvYkt2Nk9lWWhZTXgxUWR5TWprSjVrKzhnWDJQMFlrWUpvYlNib2NqNm5jaFVuZnRuM0xaZzlXU0xsRXM2T3oyVVNoUHBPV014ZkgvSzBoWVFtcnBhcFpBNDRFR0hWcmNXdWk0ek9LbFVuZ0dNZlgwNE82ZFVDV3FweE9RempXYVYyd1BxdXVnUDdpSnZBNlVPZzdJVlpwU2JEVGNKc0h5ZmliMzlvY3ZWMWtkOVZJTWVWQ0RQVVdKQUh0anNBTWZCTE5DYjkxWmYrelZlUVpRNTJaYVFzTGVtem13SHppeDJyTXdLSVVtR3NLQWt1SVlmS3lHVEdxb0sxZjZyZzJmTkNkSEdGaEM5WHZNY0wyQVhHNDc1SStidU01WXVTU0g2VVFqR09qMC9jc3R3emx1aGZmd0k2N2dZVC9GWG9GSlB3ejRtdm8ydEFKK1dUMXJ1MUE5bzdndHRJTkllVlo5WThPTmRsSjRCOWdJV3VXRkxyRFV6cWFoU0ovcTRzQzhTWDBNSkZQeDBRNnVBYldqeVViazBydXo0WHhWRkhEeml5UU5Jc29tbVVQQkpFS0txT0swS3dEejl6ZmhHaHZmYWNleGwzYnB3aUhzUEh5Z1BEaGtWMjhuanUrcUpUSXV1cExUZ1lGTFFWbG1lOVJEL0Y3TlNxRHdLb01DWHBrL29Sc2oxYzhmMUJ0elQ3aVJJNnpmOC8zMG8xbVk2ayt0QWdmbjkwZjQrZUcvWE9OaFdRQlhibnJuMGZOaHR1cHlSTXN0SGZYOHZCUU9NVklMZ0xqb2RtRnNveS9UMkNUdjlONk96Y2luYjBaN3FkVmY4eFowOE9JMXRSVHJqYldYSnFlVnJLWEFrS1ZUSGp4Z3YwcjYxdG1mRWdUcVYxOXlUYjhpL25EQm9YRTVibkJaejNVMEx5ZEQ5bUt4K1ZWK1hZaWkzSkNrNmhhaHRpRjRzaXdLbW15VHJDZ3FRSEFLZWd5OTJyNDB3VFZ4SlorK1FKcWg4OW1wOEFiUjNaYWtKR0JJWm5oTVVtOHphaGFuLzc5UEEydHp4aGVCTVdiMmg2SjhXWGQrQnNUbHVSRXJMSDhNQzIzcFNoL0tuUzBTTjBPYmNCNGtseDEvNUtLenFhb1NMUUtiVXBDQU9aY1N0UWJ0SDNmdWUrWjBMNFVRM1dVR0x4NksxaXRESmxwc2Y0dHIxSWhHOTlDaXI3ekFDTW1SSE4rcUYwZEwwbnJLOE1BM1E0NHpvYmtyNkVqcG9qengrWVBHcWN5WjZ5VmZIcEVPTUpzRGM0WWRsQWV6cGY0c214OUoyTldlWjNrcUR2czQwbFo0U1cySEVIbDdlN2IwdWhEcVljeTBwTCtMM0tsejJmWkxhTW5Fc2lxYjRPQ0dVenFNQ3ovbUtxOWcwZ1pFRHhWUVRjYlA0NDc0SjNmVHBvSk1wczI1bTBZcnJKL0YxcXZXbXdnVWszUHI4dFhwZ0J3UENPK29iR243RWt4eEtPSUlwWkZQTnZhT2JGcXJTVkVXaXVrcnYxVzc0QmRxempSbHA5U1phL3BTTStxelhESWM4RzFPbWJCaGd0TXVrL0VBVzBKcmc9PSJ9";

async function revealContent(inputPassword) {
  try {
    const ct = JSON.parse(atob(ct_serial));
    const decryptedText = await decrypt(ct, inputPassword); // Await the async function
    document.getElementById('contents').innerHTML = decryptedText;
    // console.log('==== conents below =====')
    // console.log(decryptedText);
    // console.log('==== conents above =====')


    // Regular expression to match <script> tags and capture their contents
    const sre = /<script\b[^>]*>([\s\S]*?)<\/script>/gm;
    let m;

    // Iterate over all matches and capture the script contents
    while ((m = sre.exec(decryptedText)) !== null) {
      var ns = document.createElement('script');
      ns.innerHTML = m[1];
      document.head.appendChild(ns);
      // console.log(m[1]);
      eval(m[1]);
    }

    document.getElementById('password-input').classList.remove('error');
    document.getElementById('password-input').classList.add('success');
    await sleep(1000);
    document.getElementById('render-container').classList.remove('above');

    document.getElementById('password-container').classList.add('hidden');
    document.getElementById('about').classList.add('hidden');
    document.getElementById('logo').classList.add('small');

    // set the password cookie
    document.cookie = "password=" + inputPassword + ';samesite=strict';

  } catch (error) {
    document.getElementById('password-input').classList.add('error');
    console.error('Password incorrect');
    //alert('Password incorrect');
  }
}

// Set up the event handler
document.addEventListener('DOMContentLoaded', (event) => {
  const inputField = document.getElementById('password-input');

  // check if the password is stored in cookies
  if (document.cookie != null) {
    let cookies = document.cookie.split(';');
    cookies.forEach(element => {
      curCookie = element.split('=');
      if (curCookie[0] === 'password') {
        revealContent(curCookie[1]);
      }
    });
  }

  // Input field event listener
  inputField.addEventListener('keydown', async function (event) {
    if (event.key === 'Enter') {
      const inputPassword = inputField.value;
      await revealContent(inputPassword);
    }
  });
});